!function(e){var t={};function n(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(s,a,function(t){return e[t]}.bind(null,a));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const s={};function a(){return s}class r{static hideAllPages(){let e=document.getElementsByClassName("page");for(let t=0;t<e.length;t++)e[t].hidden=!0}static showOnlyOnePage(e){r.hideAllPages(),document.querySelector("."+e).hidden=!1}}function i(...e){e.forEach(e=>{document.querySelector("#"+e.button).addEventListener("click",()=>{r.showOnlyOnePage(e.nextPage),history.pushState({},"",e.pagePath)})})}class o{constructor(){o.pagePath(),o.pageBoxName(),this.addEventsOnButtons()}static pagePath(){}static pageBoxName(){}addEventsOnButtons(){}addRedirectOnButtons(...e){i(...e)}}function d(e){console.log(e)}const l={OK_MESSAGE:"ok",EMPTY_MESSAGE:"empty",INCORRECT_MESSAGE:"incorrect"};class c{static responseOk(){return l.OK_MESSAGE}static responseEmpty(){return l.EMPTY_MESSAGE}static responseIncorrect(){return l.INCORRECT_MESSAGE}static correctLogin(e){if(!e)return c.responseEmpty();return/^[\w\d]{3,10}$/.test(e)?c.responseOk():c.responseIncorrect()}static correctPassword(e){if(!e)return c.responseEmpty();return/^[\w\d]{3,10}$/.test(e)?c.responseOk():c.responseIncorrect()}static hasDuplicates(e){console.log(e);for(let t=0;t<e.length;++t)for(let n=t+1;n<e.length;n++)if(console.log("i = "+t+"; "+n+" = "+e[t].variant+"; "+e[n].variant),e[t].variant===e[n].variant)return!0;return!1}static correctQuiz(e){console.log(e);let t=[],n=!1,s=document.getElementsByClassName("necessary-field");""===e.title&&(n=!0),""===e.description&&(n=!0),""===e.tags&&(n=!0);for(let e=0;e<s.length;e++)s[e].setAttribute("data-nec","true"),d(s[e]),""===s[e].value&&(n=!0,s[e].setAttribute("data-nec","empty"));return e.questions.forEach((e,s)=>{""===e.question&&(n=!0),"NaN"===e.answer.toString()&&(n=!0),"NaN"===e.points.toString&&(n=!0);let a=e.variants.filter(e=>""!==e);this.hasDuplicates(a)&&t.push(`&#9888; В вопросе ${s+1} есть повторяющиеся варианты ответа`),a<2&&(n=!0),parseInt(document.getElementById(`edit-quiz-form__question-box_${s}`).querySelector(".true-var").value)>a.length&&(document.getElementById(`edit-quiz-form__question-box_${s}`).querySelector(".true-var").setAttribute("data-nec","big"),t.push(`&#9888; Номер правильного варианта в вопосе ${s+1} превышает количество вариантов`))}),n&&t.push("&#9888; Заполните обязательные поля"),t}}const u={HTTP_OK:2,XHR_READY:4},g=!0;class p{static baseUrl(){return"http://46.229.213.75:8000/"}static requestToHost(e="GET",t,n=null,s){const r=new XMLHttpRequest;r.open(e,this.baseUrl()+t,!0),r.withCredentials=g;const i=JSON.stringify(n);r.setRequestHeader("Content-Type","application/json; charset=utf8"),r.setRequestHeader("Authorization",a().authWorker.getToken()),"GET"===e?r.send(null):r.send(i),r.onreadystatechange=function(){if(r.readyState!==u.XHR_READY)return;if(parseInt(+r.status/100)!==u.HTTP_OK)return"Invalid token."===JSON.parse(r.responseText).message&&a().authWorker.deleteToken(),d(r.status+" from 400"),s(r,null);const e=JSON.parse(r.responseText);s(null,e)}}static auth(e,t,n){const s={username:e,password:t};p.requestToHost("POST","api/session/",s,n)}static register(e,t,n){const s={username:e,password:t};p.requestToHost("POST","api/users/",s,n)}static whoami(e){p.requestToHost("GET","api/users/me/",null,e)}static quizNew(e,t){p.requestToHost("POST","api/quizzes/",e,t)}static quizEdit(e,t,n){console.log("id = "+e),p.requestToHost("PUT",`api/quizzes/${e}/`,t,n)}static quizzesAll(e){p.requestToHost("GET","api/quizzes/",null,e)}static quizzesOfUser(e){p.requestToHost("GET","api/users/me/quizzes/",null,e)}static changeUserData(e,t,n){const s={last_name:e,email:t};p.requestToHost("PATCH","api/users/me/",s,n)}static changePassword(e,t,n){const s={old_password:e,new_password:t};p.requestToHost("POST","api/users/me/password/",s,n)}static getQuizById(e,t){p.requestToHost("GET",`api/quizzes/${e}/`,null,t)}static createGame(e,t="",n,s){let a=null;a=null===n?{quiz:e,label:t,online:!0}:{quiz:e,label:t,online:!0,group:n},p.requestToHost("POST","api/games/",a,s)}static organizationsAll(e){p.requestToHost("GET","api/organizations/",null,e)}static getOrganizationsById(e,t){p.requestToHost("GET",`api/organizations/${e}/`,null,t)}static getRunningGameByGroupId(e,t){p.requestToHost("GET",`api/groups/${e}/games/running/`,null,t)}}var m={clearFields(...e){e.forEach(e=>{const t="#"+e;let n=document.querySelector(t);"INPUT"===n.nodeName?n.value="":"DIV"===n.nodeName&&(n.innerHTML="")})}};const _={EMPTY_MESSAGE:"Заполнены не все поля",INCORRECT_MESSAGE:"Использованы недопустимые символы",RESPONSE_MESSAGE:"Некорректный ввод или логин уже существует",UNIQUE_MESSAGE:"Пользователь с таким логином<br>уже существует",TOO_SHORT_LOGIN:"Пароль должен содержать<br>не менее 4х символов",SUCCESS_SIGN_UP_MESSAGE:"Вы успешо зарегистрировались!",CONTENT_SHOULD_BE:"Логин и пароль должны состоять<br>из латинских букв и цифр"};class E extends c{constructor(){super(),Object.assign(E.prototype,m),this.loginValue="",this.passwordValue="",this.errorBox=null,this.addEventsToButtons(),console.log("reg FORM")}static msgEmptyField(){return _.EMPTY_MESSAGE}static msgIncorrectInput(){return _.CONTENT_SHOULD_BE}static msgTooShortPassword(){return _.TOO_SHORT_LOGIN}static msgNotUniqueLogin(){return _.UNIQUE_MESSAGE}static msgResponseFromHost(){return _.RESPONSE_MESSAGE}static msgSignUpSuccess(){return _.SUCCESS_SIGN_UP_MESSAGE}static validate(e,t,n){let s=c.correctLogin(e),a=c.correctPassword(t);return s===c.responseEmpty()||a===c.responseEmpty()?(n.innerHTML=E.msgEmptyField(),!1):s===c.responseIncorrect()||a===c.responseIncorrect()?(n.innerHTML=E.msgIncorrectInput(),!1):(n.innerHTML="",!0)}clearForm(){this.clearFields("regform-login","regform-password","regform-err")}sendRequest(){let e="";p.register(this.loginValue,this.passwordValue,(t,n)=>{if(t)return t=JSON.parse(t.responseText),console.log(JSON.stringify(t)),void 0!==t.username?"unique"===t.username[0].code&&(d("UNIQ = "),e=E.msgNotUniqueLogin()):void 0!==t.password&&"invalid"===t.password[0].code&&(d("INV = "),e=E.msgTooShortPassword()),this.errorBox.innerHTML=e;a().authWorker.autharization(n),this.clearForm(),a().officePage.render(),a().btn.officeBtn.click()})}addEventsToButtons(){document.querySelector("#regformBtn").addEventListener("click",()=>{this.loginValue=document.querySelector("#regform-login").value,this.passwordValue=document.querySelector("#regform-password").value,this.errorBox=document.querySelector("#regform-err"),E.validate(this.loginValue,this.passwordValue,this.errorBox)&&this.sendRequest()})}}class h extends o{constructor(){super(),this.form=new E}static pagePath(){return"/register"}static pageBoxName(){return"register-page"}getForm(){return this.form}addEventsOnButtons(){}}const y={EMPTY_MESSAGE:"Заполнены не все поля",INCORRECT_MESSAGE:"Использованы недопустимые символы",RESPONSE_MESSAGE:"Некорректный ввод или логина не существует",SUCCESS_SIGN_IN_MESSAGE:"Вы вошли на сайт!"};class b extends c{constructor(){super(),Object.assign(b.prototype,m),this.loginValue="",this.passwordValue="",this.errorBox=null,this.addEventsToButtons(),console.log("log FORM")}static msgEmptyField(){return y.EMPTY_MESSAGE}static msgIncorrectInput(){return y.INCORRECT_MESSAGE}static msgResponseFromHost(){return y.RESPONSE_MESSAGE}static msgSignUpSuccess(){return y.SUCCESS_SIGN_IN_MESSAGE}static validate(e,t,n){let s=c.correctLogin(e),a=c.correctPassword(t);return s===c.responseEmpty()||a===c.responseEmpty()?(n.innerHTML=b.msgEmptyField(),!1):s===c.responseIncorrect()||a===c.responseIncorrect()?(n.innerHTML=b.msgIncorrectInput(),!1):(n.innerHTML="",!0)}clearForm(){this.clearFields("login-form-login","login-form-password","login-form-err")}sendRequest(){p.auth(this.loginValue,this.passwordValue,(e,t)=>{if(e)return this.errorBox.innerHTML=b.msgResponseFromHost();a().authWorker.autharization(t),this.clearForm(),a().officePage.render(),a().btn.officeBtn.click()})}addEventsToButtons(){document.querySelector("#login-form-btn").addEventListener("click",()=>{this.loginValue=document.querySelector("#login-form-login").value,this.passwordValue=document.querySelector("#login-form-password").value,this.errorBox=document.querySelector("#login-form-err"),console.log("log BTN"),b.validate(this.loginValue,this.passwordValue,this.errorBox)&&this.sendRequest()})}}class v extends o{constructor(){super(),this.form=new b}static pagePath(){return"/login"}static pageBoxName(){return"login-page"}getForm(){return this.form}addEventsOnButtons(){}}function f(e,t,n){return`<img class="card-img-top" src="img/quiz_logo.png" alt="Card image cap">\n            <div class="card-body">\n                <h5 class="card-title">${e}</h5>\n                <p class="card-text">${t}</p>\n            </div>\n            <div class="card-footer">\n                <small class="text-muted">Дата изменения ${n}</small>\n            </div>`}class q extends o{static newQuizCard(){return'<div id="card-row-1" class="card-deck">\n                                <div id="new-quiz" class="card new-quiz">\n                                    <img class="card-img-top" src="img/add_quiz.png" alt="Card image cap">\n                                    <div class="card-body text-white">\n                                        <h5 class="card-title">Новая викторина</h5>\n                                        <hr>\n                                        <p class="card-text">Создание нового набора вопросов</p>\n                                    </div>\n                                </div>'}static redirectToQuiz(e){console.log(e),p.getQuizById(e,(t,n)=>{t?console.log(t):(console.log("quiz "+e+" rendering"),a().quizEditorPage.render(e,n))})}static renderNewQuizCard(e){e.innerHTML=q.newQuizCard(),i({button:"new-quiz",nextPage:"edit-page",pagePath:"/edit"}),document.getElementById("new-quiz").addEventListener("click",()=>{a().quizEditorPage.clearForm()}),document.getElementById("new-quiz").hidden=!0}static render(){console.log("Quiz Desk");let e=document.getElementById("quizzes-desk");e.innerHTML="",q.renderNewQuizCard(e),q.quizzesReq(t=>{console.log(t);let n=1,s=1;for(let a=0;a<t.length;a++)if(3===n&&(n=0,s++),1===s&&n<3){console.log("first str");let e=document.createElement("div");e.setAttribute("id",`quiz-card-${t[a].id}`),e.setAttribute("class","card quizzes-desk__quiz-card"),e.innerHTML=f(t[a].title,t[a].description,t[a].version_date.split("T")[0]),document.getElementById("card-row-1").appendChild(e),document.getElementById(`quiz-card-${t[a].id}`).onclick=(()=>{q.redirectToQuiz(t[a].id)}),n++}else{if(0===n){let t=document.createElement("div");t.setAttribute("id",`card-row-${s}`),t.setAttribute("class","card-deck"),e.appendChild(t),console.log("new row = "),console.log(t)}let r=document.createElement("div");r.setAttribute("id",`quiz-card-${t[a].id}`),r.setAttribute("class","card quizzes-desk__quiz-card"),r.innerHTML=f(t[a].title,t[a].description,t[a].version_date.split("T")[0]),document.getElementById(`card-row-${s}`).appendChild(r),document.getElementById(`quiz-card-${t[a].id}`).onclick=(()=>{q.redirectToQuiz(t[a].id)}),n++}document.getElementById("new-quiz").hidden=!1})}static quizzesReq(e){p.quizzesOfUser(function(t,n){if(t)return console.log(" error");console.log("quizzes of user norm"),console.log(t),console.log(n),e(n)})}}const B={INCORRECT_MESSAGE:"Использованы недопустимые символы",SUCCESS_MESSAGE:"Данные изменены!"};class w extends c{constructor(){super(),Object.assign(w.prototype,m),this.nameValue=document.querySelector("#profile-name").value,this.emailValue=document.querySelector("#profile-email").value,this.passwordValue=document.querySelector("#profile-old-password").value,this.newPasswordValue=document.querySelector("#profile-new-password").value,this.newPasswordValueRepeat=document.querySelector("#profile-repeat-password").value,this.errorBox=null,this.addEventsToButtons(),console.log("prof FORM")}static msgIncorrectInput(){return B.INCORRECT_MESSAGE}static msgSuccess(){return B.SUCCESS_MESSAGE}static validate(e,t,n,s,a){return!0}setFormValues(e){this.clearFields("profile-name","profile-email","profile-old-password","profile-new-password","profile-repeat-password","profile-form-error"),console.log(this.nameValue+" "+e.last_name),document.querySelector("#profile-name").value=e.last_name,document.querySelector("#profile-email").value=e.email}sendRequest(){p.changeUserData(this.nameValue,this.emailValue,(e,t)=>{if(e)return document.getElementById("profile-form-error").innerHTML="patch err",console.log("patch err");this.setFormValues(t),document.getElementById("profile-form-ok").innerHTML=w.msgSuccess()})}sendRequestChangePswd(){p.changePassword(this.passwordValue,this.newPasswordValue,(e,t)=>{if(e)return document.getElementById("profile-form-error").innerHTML="pswd err",console.log("pswd err");document.getElementById("profile-form-ok").innerHTML=w.msgSuccess()})}addEventsToButtons(){document.querySelector("#profile-form-btn").addEventListener("click",()=>{this.nameValue=document.querySelector("#profile-name").value,this.emailValue=document.querySelector("#profile-email").value,this.passwordValue=document.querySelector("#profile-old-password").value,this.newPasswordValue=document.querySelector("#profile-new-password").value,this.newPasswordValueRepeat=document.querySelector("#profile-repeat-password").value,console.log("prof BTN"),w.validate(this.nameValue,this.emailValue,this.passwordValue,this.newPasswordValue,this.newPasswordValueRepeat)&&(""!==this.passwordValue?this.newPasswordValue===this.newPasswordValueRepeat&&""!==this.newPasswordValue?(this.sendRequestChangePswd(),console.log("prof ch data"),this.sendRequest()):document.getElementById("profile-form-error").innerHTML="Неверно повторили пароль":""!==this.newPasswordValue?document.getElementById("profile-form-error").innerHTML="Введите старый пароль":this.sendRequest())})}}class I{getToken(){return null!==localStorage.getItem("token")?localStorage.getItem("token"):"no"}static getSessionKey(){return null!==localStorage.getItem("session_key")?localStorage.getItem("session_key"):"no"}static getUsername(){return null!==localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")).username:"no"}static setToken(e){let t="Token "+e.token.toString();localStorage.setItem("token",t),console.log("TOKEN = "+localStorage.getItem("token"))}static setSessionKey(e){let t=e.session_key.toString();localStorage.setItem("session_key",t),console.log("session_key = "+localStorage.getItem("session_key"))}static setUser(e){localStorage.setItem("user",JSON.stringify(e)),console.log("USER = "+localStorage.getItem("user"))}autharization(e){I.setToken(e),I.setSessionKey(e),I.setUser(e)}deleteToken(){localStorage.removeItem("token"),localStorage.removeItem("session_key"),localStorage.removeItem("user")}}const S="ws://api.keklik.xyz/?session_key=",x="teacher",T="student",z={subscribe:"subscribe",join:"join",next_question:"next_question",answer:"answer",finish:"finish"},M={answering:"answering",finish:"finish"};class O{constructor(e="unknown"){this.role=e,this.socket=null,this.create(),this.addEvents()}create(){this.socket=new WebSocket(`${S}${I.getSessionKey()}`)}addEvents(){this.socket.onopen=(()=>{d("EEEEEEEEEEEEEEEEEEEEEEEEEEEEE"),d("Соединение установлено"),d("EEEEEEEEEEEEEEEEEEEEEEEEEEEEE"),this.role===x?this.subscribeTeacher(a().gameManager.game_id):this.role===T&&(this.joinStudent(a().gameManager.game_id),this.subscribeStudent(a().gameManager.game_id))}),this.socket.onclose=(e=>{d("EEEEEEEEEEEEEEEEEEEEEEEEEEEEE"),d("Соединение закрыто"),d("EEEEEEEEEEEEEEEEEEEEEEEEEEEEE")}),this.socket.onmessage=(e=>{d("EEEEEEEEEEEEEEEEEEEEEEEEEEEEE"),d("Получено сообщение: "+e.data),d("EEEEEEEEEEEEEEEEEEEEEEEEEEEEE");const t=JSON.parse(e.data);this.role===x?t.payload.action===z.next_question&&t.payload.data.state!==M.finish?(d(t.payload.data.current_question+"_TEACHER_____________________________"),a().gameTeacherPage.renderQuestion(t)):t.payload.data.state===M.finish?(d("_________________FINISH___________________"),a().gameTeacherPage.renderFinish(t),a().gameManager.reset()):t.payload.action===z.answer?a().gameTeacherPage.renderGameTable(t):t.payload.action===z.join&&(a().gameManager.joined_counter+=1,d("JOINED________________"+a().gameManager.joined_counter),a().gameTeacherPage.renderAnsweredCounter(),a().gameTeacherPage.renderJoinedCounter()):this.role===T&&(t.payload.action===z.next_question&&t.payload.data.state!==M.finish?(d(t.payload.data.current_question+"_STUDENT_____________________________"),a().gameStudentPage.renderQuestion(t)):t.payload.action===z.finish&&(d("_________________FINISH___________________"),a().gameStudentPage.renderFinish(t),a().gameManager.reset()))}),this.socket.onerror=(e=>{d("EEEEEEEEEEEEEEEEEEEEEEEEEEEEE"),d("Ошибка: "+e.message),d("EEEEEEEEEEEEEEEEEEEEEEEEEEEEE")})}joinStudent(e){d("SEND JOIN STUDENT"),this.socket.send(JSON.stringify({stream:"games",payload:{action:"join",pk:e}}))}subscribeTeacher(e){d("SEND SUBSCRIBE TEACHER"),this.socket.send(JSON.stringify({stream:"games",payload:{action:"subscribe",pk:e,data:{action:"join"}}})),this.socket.send(JSON.stringify({stream:"games",payload:{action:"subscribe",pk:e,data:{action:"answer"}}}))}subscribeStudent(e){d("Subscribe STUDENT"),this.socket.send(JSON.stringify({stream:"games",payload:{action:"subscribe",pk:e,data:{action:"next_question"}}})),this.socket.send(JSON.stringify({stream:"games",payload:{action:"subscribe",pk:e,data:{action:"finish"}}}))}sendNextMessage(e){d("GAME ID in sending = "+e),this.socket.send(JSON.stringify({stream:"games",payload:{action:"next_question",pk:e}}))}sendAnswerMessage(e,t,n){d("GAME ID in ANSWERING = "+e),this.socket.send(JSON.stringify({stream:"games",payload:{action:"answer",data:{answer:[t],question:n},pk:e}}))}disconnect(){this.socket.close()}}class k{constructor(){a().gameManager=this,console.log("GAME MANAGER START"),this.ws_controller=null,this.game_id=null,this.joined_counter=0,this.answered_counter=0,this.game_started=!1}start(e,t,n){document.getElementById("focus-btn").focus(),console.log("Переход на страницу с игрой "+e),p.createGame(e,t,n,(e,t)=>{e?console.log(e):(this.game_id=t.id,a().gameTeacherPage.renderQuizNum(this.game_id),console.log("GAME ID = "+this.game_id),this.ws_controller=new O("teacher"),console.log("WS"))})}join(e){document.getElementById("focus-btn").focus(),this.game_id=e,this.ws_controller=new O("student"),a().gameStudentPage.renderWaitingStart()}switchNext(){!1===this.game_started&&(a().gameTeacherPage.prepareGameMode(),this.game_started=!0),this.answered_counter=0,a().gameTeacherPage.renderAnsweredCounter(),this.ws_controller.sendNextMessage(this.game_id)}sendAnswer(e,t){this.ws_controller.sendAnswerMessage(this.game_id,e,t),a().gameStudentPage.renderWaitingNext()}reset(){a().prev_game=this.game_id,this.ws_controller.disconnect(),this.ws_controller=null,this.game_id=null,this.joined_counter=0,this.answered_counter=0,this.game_started=!1}stop(){}}function P(e,t,n){return`<img class="card-img-top" src="img/course_logo.png" alt="Card image cap">\n            <div class="card-body">\n                <h5 class="card-title">${e}</h5>\n                <p class="card-text">${t} групп на курсе</p>\n            </div>\n            <div class="card-footer">\n                <small class="text-muted">Дата изменения ${n}</small>\n            </div>`}function H(e){let t=[],n=a().saver.userGroups.length;for(let s=0;s<n;s++)a().saver.userGroups[s].group.organization.id===e&&t.push(a().saver.userGroups[s]);return t}class L extends o{static render(){console.log("Quiz Desk");let e=document.getElementById("org-desk");e.innerHTML="";let t=0,n=1,s=a().saver.userOrg;0===s.length&&(e.innerHTML="<h3>Вы не состоите ни в одной организации</h3>");for(let a=0;a<s.length;a++){if(3===t&&(t=0,n++),0===t){let t=document.createElement("div");t.setAttribute("id",`org-card-row-${n}`),t.setAttribute("class","card-deck"),e.appendChild(t),console.log("new row = "),console.log(t)}let r=document.createElement("div");r.setAttribute("id",`org-card-${s[a].id}`),r.setAttribute("class","card org-desk__org-card");let i=[];i=H(s[a].id),r.innerHTML=P(s[a].name,i.length,s[a].updated_at.split("T")[0]),document.getElementById(`org-card-row-${n}`).appendChild(r),document.getElementById(`org-card-${s[a].id}`).onclick=(()=>{L.redirectToOrganization(s[a].id,s[a].name)}),t++}}static redirectToOrganization(e,t){d("redirect to course "+e+" with name "+t),a().organizationPage.render(e,t)}static organizationReq(e){p.organizationsAll((t,n)=>{if(t)return alert("all organizations error");d(n);let s=[],a=n.length;for(let e=0;e<a;e++){let t=n[e].admins,a=t.length;d(n[e]);for(let r=0;r<a;r++)t[r].user.username===I.getUsername()&&(s.push(n[e]),d("pushed"))}e(s)})}}class N extends o{constructor(){super();let e=document.createElement("button");e.setAttribute("id","to-course-btn-redirect"),e.hidden=!0,document.body.appendChild(e),this.addRedirectOnButtons({button:"to-course-btn-redirect",nextPage:"course-page",pagePath:"/course"}),this.addEventsOnButtons(),console.log("office"),a().user={},this.profileForm=new w,a().count_ws=0,a().joinBtnFlag=!1}static pagePath(){return"/office"}static pageBoxName(){return"office-page"}joinGameBtn(){a().gameStudentPage.attachRedirect(),document.getElementById("join-game-btn").addEventListener("click",()=>{const e=parseInt(document.getElementById("game-pin-input").value);d("INPUT ID = "+e),isNaN(e)?document.getElementById("game-pin-input").setAttribute("data-nec","empty"):(document.getElementById("join-game-btn_clicker").click(),document.getElementById("game-pin-input").setAttribute("data-nec","true"),a().gameManager.join(e),a().count_ws+=1,console.log("WS COUNT = "+a().count_ws),document.getElementById("game-pin-input").value="")})}render(){return p.whoami((e,t)=>e?alert("office error"):(a().user=t,document.getElementById("office-header-username").innerHTML=a().user.username,a().nav.loginBox.innerHTML=t.username,this.profileForm.setFormValues(t),L.render(),q.render(),!1===a().joinBtnFlag&&(this.joinGameBtn(),a().joinBtnFlag=!0),console.log("office norm")))}addEventsOnButtons(){document.getElementById("to-courses-btn").onclick=(()=>{console.log("C1"),document.getElementById("org-desk").hidden=!1,document.getElementById("to-quizzes-btn").classList.remove("active"),document.getElementById("quizzes-desk").hidden=!0,document.getElementById("to-courses-btn").classList.add("active"),document.getElementById("profile").hidden=!0,document.getElementById("to-profile-btn").classList.remove("active")}),document.getElementById("to-quizzes-btn").onclick=(()=>{console.log("C2"),document.getElementById("org-desk").hidden=!0,document.getElementById("to-quizzes-btn").classList.add("active"),document.getElementById("quizzes-desk").hidden=!1,document.getElementById("to-courses-btn").classList.remove("active"),document.getElementById("profile").hidden=!0,document.getElementById("to-profile-btn").classList.remove("active")}),document.getElementById("to-profile-btn").onclick=(()=>{console.log("C3"),document.getElementById("org-desk").hidden=!0,document.getElementById("to-quizzes-btn").classList.remove("active"),document.getElementById("quizzes-desk").hidden=!0,document.getElementById("to-courses-btn").classList.remove("active"),document.getElementById("profile").hidden=!1,document.getElementById("to-profile-btn").classList.add("active")})}}class A extends o{constructor(){super(),this.addEventsOnButtons();let e=document.createElement("button");e.setAttribute("id","to-group-btn-redirect"),e.hidden=!0,document.body.appendChild(e),this.addRedirectOnButtons({button:"to-group-btn-redirect",nextPage:"group-page",pagePath:"/group"}),console.log("course")}static pagePath(){return"/course"}static pageBoxName(){return"course-page"}render(e,t){document.getElementById("to-course-btn-redirect").click(),d("ID ORGANIZATION = "+e+"_________userGroupsByOrgId"),document.querySelector("#org-title span").innerHTML=t;let n=H(e);console.log(n);let s=n.length,a=document.getElementById("table-groups-in-org");a.innerHTML="";for(let e=0;e<s;e++)a.innerHTML+=`<div id="group-card-${n[e].group.id}" class="card game-card-in-group">\n              <div class="card-header">\n                ${n[e].group.name}\n              </div>\n              \x3c!--<div class="card-body">--\x3e\n                \x3c!--<h5 class="card-title">Актуальные соревнования</h5>--\x3e\n                \x3c!--&lt;!&ndash;<p class="card-text">With supporting text below as a natural lead-in to additional content.</p>&ndash;&gt;--\x3e\n                \x3c!--&lt;!&ndash;<a href="#" class="btn btn-primary">Go somewhere</a>&ndash;&gt;--\x3e\n              \x3c!--</div>--\x3e\n            </div>`,p.getRunningGameByGroupId(n[e].group.id,(t,s)=>{if(t)d("err with running games of group");else{let t=s,a=t.length;if(a>0){let s=document.getElementById(`group-card-${n[e].group.id}`);d("_______________>       >        >        >_______________"),d(t);for(let e=0;e<a;e++){d(t[e]),d(t[e].id),s.innerHTML+=`<div id="group-game-${t[e].id}" class="card-body">\n                                <h5 class="card-title"><u>PIN</u> ${t[e].id}</h5>\n                                <p class="card-text"><u>Название:</u> ${t[e].quiz.title}</p>\n                                <a id="to-group-game-btn-${t[e].id}" class="btn btn-success">Присоединиться</a>\n                              </div>\n                              <hr>`,document.getElementById(`to-group-game-btn-${t[e].id}`).onclick=(()=>{d("пишу ПИН = "+t[e].id.toString()),document.getElementById("game-pin-input").value=t[e].id.toString(),document.getElementById("join-game-btn").click()})}}else{document.getElementById(`group-card-${n[e].group.id}`).innerHTML+='<div id="no-games-in-group" class="card-body">\n                            <h5 class="card-title">В группе нет активных соревнований</h5>\n                          </div>'}}})}addEventsOnButtons(){}}class G extends o{constructor(){super(),this.addEventsOnButtons(),this.addRedirectOnButtons({button:"to-play-btn-1",nextPage:"play-page",pagePath:"/play"}),console.log("group")}static pagePath(){return"/group"}static pageBoxName(){return"group-page"}addEventsOnButtons(){}}class C extends o{constructor(){super(),this.index=1,d("Quiz editor"),this.quiz={},this.resetQuiz(),a().quizEditorPage=this,this.editQuizById=!1,this.target_group_id=null}resetQuiz(){this.quiz={title:"",description:"",tags:"",questions:[]},this.index=1}addQuestion(e){d("INDEX = "+e),d("INDEX+ = "+(e=document.getElementsByClassName("edit-quiz-form__question-box").length));let t=document.createElement("div");t.innerHTML=function(e){return`<div class="edit-quiz-form__question-box" id="edit-quiz-form__question-box_${e}">\n             <button id="delete-question-box_${e}" type="button" class="delete-question-box close" data-dismiss="alert" aria-label="Close">\n                <span aria-hidden="true">×</span>\n             </button>\n            <div class="input-group mb-3">\n                <div class="input-group-prepend">\n                    <span id=q_num_${e} class="q_num_span input-group-text">Вопрос ${e+1} <red>&nbsp;*</red></span>\n                </div>\n                <textarea class="edit-question form-control necessary-field" data-nec="true" aria-label="Описание..."></textarea>\n            </div>\n\n            <div class="row edit-quiz-form-ans-row">\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-prepend">\n                            <span class="input-group-text">Вариант 1<red>&nbsp;*</red></span>\n                        </div>\n                        <input type="text" class="edit-variant form-control necessary-field" data-nec="true" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-prepend">\n                            <span class="input-group-text">Вариант 2<red>&nbsp;*</red></span>\n                        </div>\n                        <input type="text" class="edit-variant form-control necessary-field" data-nec="true" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n            </div>\n            <div class="row edit-quiz-form-ans-row">\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-prepend">\n                            <span class="input-group-text">Вариант 3</span>\n                        </div>\n                        <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-prepend">\n                            <span class="input-group-text">Вариант 4</span>\n                        </div>\n                        <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n            </div>\n            <div class="row edit-quiz-form-ans-row">\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-prepend">\n                            <span class="input-group-text">Вариант 5</span>\n                        </div>\n                        <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-prepend">\n                            <span class="input-group-text">Вариант 6</span>\n                        </div>\n                        <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n            </div>\n            <div class="row edit-quiz-form-ans-row">\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-prepend">\n                            <span class="input-group-text">Вариант 7</span>\n                        </div>\n                        <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-prepend">\n                            <span class="input-group-text">Вариант 8</span>\n                        </div>\n                        <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n            </div>\n            <div class="row edit-quiz-form-ans-row">\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-prepend">\n                            <span class="input-group-text bg-success text-white">Правильный вариант<red>&nbsp;*</red></span>\n                        </div>\n                        <input maxlength="1" type="number"  min="1" max="8" class="true-var edit-answer form-control necessary-field numeric-field" data-nec="true" placeholder="1" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-prepend">\n                            <span class="input-group-text bg-info text-white">Очки за ответ<red>&nbsp;*</red></span>\n                        </div>\n                        <input maxlength="3" type="number" min="1" max="999" class="edit-points form-control necessary-field numeric-field" data-nec="true" placeholder="5" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n            </div>\n            <hr>\n        </div>`}(e),document.getElementById("edit-quiz-form__questions").appendChild(t),document.getElementById(`delete-question-box_${e}`).onclick=(()=>{this.deleteQuestion(e),d(e)}),this.index++}pushToQuiz(){this.quiz.title=document.getElementById("edit-quiz-form").querySelector("#edit-quiz-form__title").value,this.quiz.description=document.getElementById("edit-quiz-form").querySelector("#edit-quiz-form__description").value,this.quiz.tags=document.getElementById("edit-quiz-form").querySelector("#edit-quiz-form__tags").value.split(",");let e=document.getElementsByClassName("edit-quiz-form__question-box");for(let t=0;t<e.length;t++){let n=[],s=e[t].getElementsByClassName("edit-variant"),a=s.length;for(let e=0;e<a;e++){let t=s[e].value.toString();""!==t&&n.push({variant:t})}this.quiz.questions.push({type:"single",question:e[t].querySelector(".edit-question").value.toString(),variants:n,answer:[parseInt(e[t].querySelector(".edit-answer").value)],points:parseInt(e[t].querySelector(".edit-points").value)})}d(this.quiz)}validate(){let e=c.correctQuiz(this.quiz);return d("err = "+e),0===e.length||(d("__________________________________"),document.getElementById("edit-quiz-err").innerHTML=e.join("<br>"),!1)}sendRequest(){!1!==this.editQuizById?p.quizEdit(this.editQuizById,this.quiz,(e,t)=>{if(e)return document.getElementById("edit-quiz-err").innerHTML="&#9888; Обязательные поля не заполнены или заполнены с ошибками",d("err in quiz");d("ok in quiz edit"+t),a().btn.officeBtn.click(),this.editQuizById=!1}):p.quizNew(this.quiz,(e,t)=>{if(e)return document.getElementById("edit-quiz-err").innerHTML="Обязательные поля не заполнены или заполнены с ошибками",d("err in quiz");d("ok in quiz"+t),a().btn.officeBtn.click()})}startQuizBtn(e){let t=document.createElement("button");t.innerHTML="Запуcтить",t.setAttribute("id","start-game-btn"),t.setAttribute("class","btn btn-success start-btn"),document.getElementById("quiz-editor-h3").appendChild(t),a().gameManager.joined_counter=0,a().gameTeacherPage.attachRedirect(),t.addEventListener("click",()=>{d("ID = "+this.target_group_id),a().gameManager.start(this.editQuizById,e.title,this.target_group_id)})}selectTargetGroupBtn(e){document.getElementById("target-group-box").innerHTML='<div class="btn-group org-btn-group list-btn">\n                <button id="selected-org" type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                Выберите организацию...\n                </button>\n                    \n                <div id="list-org-btn" class="dropdown-menu" x-placement="bottom-start" style="position: absolute; transform: translate3d(0px, 38px, 0px); top: 0px; left: 0px; will-change: transform;">\n                    \x3c!--<a class="dropdown-item" href="#">Школа 444</a>--\x3e\n                </div>\n            </div>\n            <div class="btn-group group-btn-group list-btn">\n                <button id="selected-group" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                    Выберите группу...\n                </button>\n\n                <div id="list-group-btn" class="dropdown-menu" x-placement="bottom-start" style="position: absolute; transform: translate3d(0px, 38px, 0px); top: 0px; left: 0px; will-change: transform;">\n                    \x3c!--<a class="dropdown-item" href="#">Класс 5Б</a>--\x3e\n                </div>\n            </div>';let t=e.length,n=document.getElementById("list-org-btn");n.innerHTML="",document.getElementById("list-group-btn").innerHTML="",document.getElementById("selected-org").innerHTML="Выберете организацию...",document.getElementById("selected-group").innerHTML="Выберете группу...";for(let s=0;s<t;s++){let t=document.createElement("a");t.setAttribute("class","dropdown-item"),n.appendChild(t),t.innerHTML=e[s].name,t.setAttribute("id",`select-org-by-id-${e[s].id}`),t.onclick=(()=>{d("change selected-org text"),document.getElementById("selected-org").innerHTML=e[s].name,this.renderListGroupByOrg(e[s].id)})}}renderListGroupByOrg(e){let t=[],n=a().saver.userTeacherGroups.length;for(let s=0;s<n;s++)a().saver.userTeacherGroups[s].organization.id===e&&t.push(a().saver.userTeacherGroups[s]);d(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),d(t);let s=t.length,r=document.getElementById("list-group-btn");r.innerHTML="",document.getElementById("selected-group").innerHTML="Выберете группу...",this.target_group_id=null;for(let e=0;e<s;e++){d(t[e]),d("________________________"),d(r);let n=document.createElement("a");n.setAttribute("class","dropdown-item"),r.appendChild(n),n.innerHTML=t[e].name,d(t[e].name),n.setAttribute("id",`select-group-by-id-${t[e].id}`),n.onclick=(()=>{d("change selected-group text "+t[e].id),document.getElementById("selected-group").innerHTML=t[e].name,this.target_group_id=t[e].id})}}render(e,t){document.getElementById("new-quiz").click(),d("ID = "+e),this.editQuizById=e,document.getElementById("quiz-editor-h3").innerHTML=`Викторина ${this.editQuizById}`,this.startQuizBtn(t),this.selectTargetGroupBtn(a().saver.userTeacherOrg),document.getElementById("edit-quiz-form").querySelector("#edit-quiz-form__title").value=t.title,document.getElementById("edit-quiz-form").querySelector("#edit-quiz-form__description").value=t.description,document.getElementById("edit-quiz-form").querySelector("#edit-quiz-form__tags").value=t.tags.join();let n=t.questions.length;d("questionsCount"+n);for(let e=1;e<n;e++)this.index=e,this.addQuestion(e);let s=document.getElementsByClassName("edit-quiz-form__question-box");for(let e=0;e<n;e++){s[e].querySelector(".edit-question").value=t.questions[e].question;let n=t.questions[e].variants,a=t.questions[e].variants.length,r=s[e].getElementsByClassName("edit-variant"),i=t.questions[e].answer[0],o=0;for(let e=0;e<a;e++)r[e].value=n[e].variant,n[e].id===i&&(o=e+1);s[e].querySelector(".edit-answer").value=o,s[e].querySelector(".edit-points").value=t.questions[e].points}}addEventsOnButtons(){document.getElementById("edit-quiz-form__add-question-btn").onclick=(()=>{this.addQuestion(this.index)}),document.getElementById("edit-quiz-form__send-btn").onclick=(()=>{this.pushToQuiz(),this.validate()?(this.sendRequest(),this.resetQuiz(),document.getElementById("edit-quiz-err").innerHTML=""):this.resetQuiz()})}clearForm(){d("clear form"),this.editQuizById=!1,d(this.editQuizById),document.querySelector(".edit-page__form").innerHTML="",document.querySelector(".edit-page__form").innerHTML='<h3 id="quiz-editor-h3">Создание викторины</h3>\n    \n        <div id="target-group-box"></div>\n        \n        <div class="edit-quiz-box" id="edit-quiz-form">\n            <div class="input-group mb-3">\n                <div class="input-group-prepend">\n                    <span class="input-group-text">Название <red>&nbsp;*</red></span>\n                </div>\n                <textarea id="edit-quiz-form__title" class="form-control necessary-field" aria-label="Новая викторина..."></textarea>\n            </div>\n            <div class="input-group mb-3">\n                <div class="input-group-prepend">\n                    <span class="input-group-text">Описание <red>&nbsp;*</red></span>\n                </div>\n                <textarea id="edit-quiz-form__description" class="form-control necessary-field" aria-label="Описание..."></textarea>\n            </div>\n\n            <div class="input-group mb-3">\n                <label>Метки викторины <red>&nbsp;*</red></label>\n                <input id="edit-quiz-form__tags" class="form-control necessary-field" type="text" placeholder="Математика, Физика">\n            </div>\n            <hr>\n            <br>\n            <div id="edit-quiz-form__questions">\n                <div class="edit-quiz-form__question-box" id="edit-quiz-form__question-box_0">\n                    <div class="input-group mb-3">\n                        <div class="input-group-prepend">\n                            <span class="input-group-text">Вопрос 1<red>&nbsp;*</red></span>\n                        </div>\n                        <textarea class="edit-question form-control necessary-field" aria-label="Описание..."></textarea>\n                    </div>\n\n                    <div class="row edit-quiz-form-ans-row">\n                        <div class="col">\n                            <div class="input-group mb-3">\n                                <div class="input-group-prepend">\n                                    <span class="input-group-text">Вариант 1<red>&nbsp;*</red></span>\n                                </div>\n                                <input type="text" class="edit-variant form-control necessary-field" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                            </div>\n                        </div>\n                        <div class="col">\n                            <div class="input-group mb-3">\n                                <div class="input-group-prepend">\n                                    <span class="input-group-text">Вариант 2<red>&nbsp;*</red></span>\n                                </div>\n                                <input type="text" class="edit-variant form-control necessary-field" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                            </div>\n                        </div>\n                    </div>\n                    <div class="row edit-quiz-form-ans-row">\n                        <div class="col">\n                            <div class="input-group mb-3">\n                                <div class="input-group-prepend">\n                                    <span class="input-group-text">Вариант 3</span>\n                                </div>\n                                <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                            </div>\n                        </div>\n                        <div class="col">\n                            <div class="input-group mb-3">\n                                <div class="input-group-prepend">\n                                    <span class="input-group-text">Вариант 4</span>\n                                </div>\n                                <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                            </div>\n                        </div>\n                    </div>\n                    <div class="row edit-quiz-form-ans-row">\n                        <div class="col">\n                            <div class="input-group mb-3">\n                                <div class="input-group-prepend">\n                                    <span class="input-group-text">Вариант 5</span>\n                                </div>\n                                <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                            </div>\n                        </div>\n                        <div class="col">\n                            <div class="input-group mb-3">\n                                <div class="input-group-prepend">\n                                    <span class="input-group-text">Вариант 6</span>\n                                </div>\n                                <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                            </div>\n                        </div>\n                    </div>\n                    <div class="row edit-quiz-form-ans-row">\n                        <div class="col">\n                            <div class="input-group mb-3">\n                                <div class="input-group-prepend">\n                                    <span class="input-group-text">Вариант 7</span>\n                                </div>\n                                <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                            </div>\n                        </div>\n                        <div class="col">\n                            <div class="input-group mb-3">\n                                <div class="input-group-prepend">\n                                    <span class="input-group-text">Вариант 8</span>\n                                </div>\n                                <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                            </div>\n                        </div>\n                    </div>\n                    <div class="row edit-quiz-form-ans-row">\n                        <div class="col">\n                            <div class="input-group mb-3">\n                                <div class="input-group-prepend">\n                                    <span class="input-group-text bg-success text-white">Правильный вариант<red>&nbsp;*</red></span>\n                                </div>\n                                <input maxlength="1" type="number"  min="1" max="8" class="true-var edit-answer form-control necessary-field numeric-field" placeholder="1" aria-label="" aria-describedby="basic-addon2">\n                            </div>\n                        </div>\n                        <div class="col">\n                            <div class="input-group mb-3">\n                                <div class="input-group-prepend">\n                                    <span class="input-group-text bg-info text-white">Очки за ответ<red>&nbsp;*</red></span>\n                                </div>\n                                <input maxlength="3" type="number"  min="1" max="999" class="edit-points form-control necessary-field numeric-field" placeholder="5" aria-label="" aria-describedby="basic-addon2">\n                            </div>\n                        </div>\n                    </div>\n                    <hr>\n                </div>\n            </div>\n            <red id="edit-quiz-err"></red>\n        </div>',this.index=1}deleteQuestion(e){a().modalWindow.setHeader("Удаление вопроса"),a().modalWindow.setBody(`Вы уверены, что хотите удалить ${e+1} вопрос?`),a().modalWindow.show(),a().modalWindow.addEventsOnButtons(()=>{d("func for OK");let t=document.getElementById(`edit-quiz-form__question-box_${e}`).parentNode;t.parentNode.removeChild(t),this.index-=1;let n=document.getElementsByClassName("edit-quiz-form__question-box");for(let e=1;e<n.length;e++)n[e].setAttribute("id",`edit-quiz-form__question-box_${e}`),n[e].querySelector(".delete-question-box").setAttribute("id",`delete-question-box_${e}`),n[e].querySelector(".q_num_span").setAttribute("id",`q_num_${e}`),n[e].querySelector(".q_num_span").innerHTML=`Вопрос ${e+1}<red>&nbsp;*</red>`,document.getElementById(`delete-question-box_${e}`).onclick=(()=>{this.deleteQuestion(e),d(e)})})}}function R(e){e+="";let t=document.createElement("div"),n=document.createTextNode(e);return t.appendChild(n),d("______@@@______"+t.innerHTML),t.innerHTML}class $ extends o{constructor(){super(),this.addEventsOnButtons(),console.log("teacher")}static pagePath(){return"/teacher"}static pageBoxName(){return"teacher-page"}attachRedirect(){this.addRedirectOnButtons({button:"start-game-btn",nextPage:"play-page-manage",pagePath:"/teacher"},{button:"exit-game-btn",nextPage:"office-page",pagePath:"/office"}),this.prepareWaitingPlayers(),console.log("add redirect")}addEventsOnButtons(){document.getElementById("next-question-btn").onclick=(()=>{a().gameManager.switchNext(),document.getElementById("game-table-question").innerHTML=""})}prepareWaitingPlayers(){document.getElementById("game-diagram-1").hidden=!0,document.getElementById("game-diagram-2").hidden=!0,document.getElementById("exit-game-btn").hidden=!0,document.getElementById("next-question-btn").innerHTML="Запустить соревнование >>",document.getElementById("answered-counter").hidden=!0,document.getElementById("joined-counter").hidden=!1,document.getElementById("game-table").hidden=!0,this.renderJoinedCounter(),this.renderAnsweredCounter()}prepareGameMode(){document.getElementById("next-question-btn").innerHTML="Следующий вопрос >>",document.getElementById("joined-counter").hidden=!0,document.getElementById("answered-counter").hidden=!1,document.getElementById("game-table").hidden=!1}renderQuestion(e){document.getElementById("question-preview").innerHTML="Вопрос "+e.payload.data.current_question.number+"/<b>"+e.payload.data.quiz.questions.length+"</b>: "+R(e.payload.data.current_question.question)}renderQuizNum(e){document.getElementById("game-num").innerHTML=`Ход соревнования ${e}`,document.getElementById("next-question-btn").hidden=!1}renderAnsweredCounter(){document.getElementById("answered-counter").querySelector("ans").innerHTML=a().gameManager.answered_counter.toString(),document.getElementById("answered-counter").querySelector("all").innerHTML=a().gameManager.joined_counter.toString()}renderJoinedCounter(){document.getElementById("joined-counter").querySelector("all").innerHTML=a().gameManager.joined_counter.toString()}renderGameTable(e){a().gameManager.answered_counter+=1,this.renderAnsweredCounter();let t=e.payload.data;console.log("DATA = "+t);let n=t.player.user.username;""!==t.player.user.last_name&&(n=t.player.user.last_name),console.log("ОТВЕТИЛ "+n),!0===t.correct?document.getElementById("game-table-question").innerHTML+=`<tr class="line-result-table table-group-line right-ans">\n                    <th scope="row">${a().gameManager.answered_counter}</th>\n                    <td>${R(n)}</td>\n                    <td>${R(t.answer[0].variant)}</td>\n            </tr>`:document.getElementById("game-table-question").innerHTML+=`<tr class="line-result-table table-group-line">\n                    <th scope="row">${a().gameManager.answered_counter}</th>\n                    <td>${R(n)}</td>\n                    <td>${R(t.answer[0].variant)}</td>\n            </tr>`}countAllAnswers(e){let t={all:0,right:0,all_points:0,right_points:0},n=e.payload.data,s=n.generated_questions.length;for(let e=0;e<s;e++){let s=n.generated_questions[e],a=s.players_answers.length;t.all+=a;for(let e=0;e<a;e++)t.all_points+=s.points,!0===s.players_answers[e].correct&&(t.right+=1,t.right_points+=s.points)}return console.log(t),t}renderFinish(e){let t=this.countAllAnswers(e),n=0,s=0;function a(e){return parseFloat(e.toFixed(2))}n=t.all;let r=0,i=0;i=100-(r=a((s=t.right)/n*100)),document.getElementById("game-diagram-1").hidden=!1,document.getElementById("game-diagram-2").hidden=!1,document.getElementById("exit-game-btn").hidden=!1;let o=new CanvasJS.Chart("game-diagram-1",{theme:"light1",exportEnabled:!0,animationEnabled:!0,title:{text:"Общий итог"},data:[{type:"pie",startAngle:25,toolTipContent:"<b>{label}</b>: {y}%",showInLegend:"true",legendText:"{label}",indexLabelFontSize:16,indexLabel:"{label} - {y}%",dataPoints:[{y:r,label:"Правильных ответов"},{y:i,label:"Неправильных ответов"}]}]}),d=a(t.right_points/t.all_points*100),l=100-d,c=new CanvasJS.Chart("game-diagram-2",{theme:"light1",exportEnabled:!0,animationEnabled:!0,title:{text:"Статистика по баллам"},data:[{type:"pie",startAngle:25,toolTipContent:"<b>{label}</b>: {y}%",showInLegend:"true",legendText:"{label}",indexLabelFontSize:16,indexLabel:"{label} - {y}%",dataPoints:[{y:d,label:"Полученные баллы"},{y:l,label:"Потерянные баллы"}]}]});o.render(),c.render(),document.getElementById("question-preview").innerHTML="Соревнование завершено",document.getElementById("next-question-btn").hidden=!0,document.getElementById("answered-counter").hidden=!0,document.getElementById("joined-counter").hidden=!0,document.getElementById("game-table").hidden=!0}}class Q extends o{constructor(){super(),this.addEventsOnButtons(),console.log("student")}static pagePath(){return"/play"}static pageBoxName(){return"play-page"}attachRedirect(){this.addRedirectOnButtons({button:"join-game-btn_clicker",nextPage:"play-page",pagePath:"/play"},{button:"exit-game-student-btn",nextPage:"office-page",pagePath:"/office"}),console.log("add redirect")}renderQuestion(e){document.getElementById("play-page-header").innerHTML="Соревнование "+e.payload.data.id+": "+e.payload.data.quiz.title,document.getElementById("play-page-question").innerHTML="Вопрос "+e.payload.data.current_question.number+"/<b>"+e.payload.data.quiz.questions.length+"</b>: "+R(e.payload.data.current_question.question);let t=e.payload.data.current_question.id,n=e.payload.data.current_question.variants.length;document.getElementById("play-page-ans-list").innerHTML="";for(let s=0;s<n;s++){let n=e.payload.data.current_question.variants[s].id,r=document.createElement("a");r.setAttribute("class","ans-variant list-group-item list-group-item-action list-group-item-info"),r.setAttribute("id",`ans-btn-${n}`),document.getElementById("play-page-ans-list").appendChild(r),document.getElementById(`ans-btn-${n}`).innerHTML=R(e.payload.data.current_question.variants[s].variant),document.getElementById(`ans-btn-${n}`).onclick=(()=>{console.log("______________click______________"),a().gameManager.sendAnswer(n,t)})}}renderWaitingStart(){document.getElementById("exit-game-student-btn").hidden=!0,document.getElementById("play-page-header").innerHTML=`Ожидание старта соревнования\n        ${a().gameManager.game_id}...`,document.getElementById("play-page-question").innerHTML="",document.getElementById("play-page-ans-list").innerHTML="",document.getElementById("play-figure").setAttribute("src","img/pic.jpg")}renderWaitingNext(){document.getElementById("play-page-header").innerHTML="Следующий вопрос...",document.getElementById("play-page-question").innerHTML="",document.getElementById("play-page-ans-list").innerHTML=""}renderFinish(e){document.getElementById("exit-game-student-btn").hidden=!1;let t=e.payload.data,n=0,s=0,a=t.generated_questions.length;for(let e=0;e<a;e++){let a=t.generated_questions[e];n+=a.points;let r=a.players_answers.length;for(let e=0;e<r;e++)a.players_answers[e].player.user.username===I.getUsername()&&!0===a.players_answers[e].correct&&(console.log("USER NAME = "+I.getUsername()),s+=a.points)}document.getElementById("play-page-header").innerHTML="Соревнование завершено",document.getElementById("play-page-question").innerHTML="Ваш результат "+s+" из "+n,document.getElementById("play-page-ans-list").innerHTML="",document.getElementById("play-figure").setAttribute("src","img/finish_flag_700.jpg")}addEventsOnButtons(){}}class V{constructor(){a().modalWindow=this,this.modalWind=document.getElementById("modal-window"),this.headerBox=document.getElementById("modal-header-box"),this.bodyBox=document.getElementById("modal-body-box"),this.okBtn=document.getElementById("ok-delete-btn"),this.cancelBtn=document.getElementById("cancel-delete-btn"),this.closeBtn=document.getElementById("close-delete-btn")}clickOk(e){this.okBtn.onclick=(()=>{d("OK"),e(),this.hide()})}clickCancel(){this.cancelBtn.onclick=(()=>{d("ОТМЕНА"),this.hide()}),this.closeBtn.onclick=(()=>{d("ЗАКРЫТЬ"),this.hide()})}addEventsOnButtons(e){d("modal click"),this.clickOk(e),this.clickCancel()}setHeader(e){this.headerBox.innerHTML=e}setBody(e){this.bodyBox.innerHTML=e}show(){this.modalWind.setAttribute("class","modal fade show"),this.modalWind.setAttribute("style","display: block")}hide(){this.modalWind.setAttribute("class","modal fade"),this.modalWind.setAttribute("style","display: none")}}class U{constructor(){this.addRedirectOnNavBtn({button:"nav-main-btn",nextPage:"main-page",pagePath:"/main"},{button:"nav-login-btn",nextPage:"login-page",pagePath:"/login"},{button:"nav-info-btn",nextPage:"info-page",pagePath:"/info"},{button:"nav-office-btn",nextPage:"office-page",pagePath:"/office"}),a().btn={},a().nav={},a().btn.loginBtn=document.getElementById("nav-login-btn"),a().btn.signoutBtn=document.getElementById("nav-signout-btn"),a().nav.loginBox=document.getElementById("nav-login-box"),a().btn.officeBtn=document.getElementById("nav-office-btn");let e=document.getElementsByClassName("btnLink");for(let t=0;t<e.length;t++)e[t].addEventListener("click",()=>{for(let t=0;t<e.length;t++)e[t].parentNode.setAttribute("class","nav-item");e[t].parentNode.setAttribute("class","nav-item active")});new V,a().registerPage=new h,a().loginPage=new v,a().officePage=new N,a().organizationPage=new A,a().groupPage=new G,a().quizEditor=new C,a().gameTeacherPage=new $,a().gameStudentPage=new Q,a().gameManager=new k;h.pagePath();i({button:"regform-to-login-link",nextPage:"login-page",pagePath:"/login"},{button:"login-form-to-register-link",nextPage:"register-page",pagePath:"/register"}),document.getElementById("participate-btn").onclick=(()=>{a().btn.officeBtn.click()}),a().btn.signoutBtn.onclick=(()=>{a().authWorker.deleteToken(),a().btn.signoutBtn.hidden=!0,a().btn.loginBtn.hidden=!1,a().btn.loginBtn.click(),a().nav.loginBox.innerHTML=""}),U.redirect(),window.addEventListener("popstate",()=>{a().modalWindow.hide(),U.redirect()})}navigate(){}addRedirectOnNavBtn(...e){i(...e)}static redirect(){const e=window.location.pathname;p.whoami((t,n)=>{if(t){switch(a().btn.signoutBtn.hidden=!0,a().btn.loginBtn.hidden=!1,a().nav.loginBox.innerHTML="",e){case"/":case"/main":r.showOnlyOnePage("main-page");break;case"/office":a().btn.loginBtn.click();break;case"/register":r.showOnlyOnePage("register-page");break;case"/login":r.showOnlyOnePage("login-page");break;case"/info":r.showOnlyOnePage("info-page");break;default:a().btn.loginBtn.click()}return console.log("NOT AUTH")}if(n){switch(a().btn.signoutBtn.hidden=!1,a().btn.loginBtn.hidden=!0,a().nav.loginBox.innerHTML=n.username,a().saver={},function(e){a().saver.userGroups=e,a().saver.userTeacherGroups=[],d(e),a().saver.userOrg=[],a().saver.userTeacherOrg=[];let t=a().saver.userGroups.length;for(let e=0;e<t;e++){"teacher"===a().saver.userGroups[e].role&&(d("@@@@@@@@___________teacher"),d(a().saver.userGroups[e]),a().saver.userTeacherGroups.push(a().saver.userGroups[e].group),d(a().saver.userTeacherGroups)),d(">>>>>>>>>>>>>>"),d(a().saver.userGroups[e].group.organization);let t=!1,n=a().saver.userOrg.length;for(let s=0;s<n;s++)a().saver.userOrg[s].id===a().saver.userGroups[e].group.organization.id&&(t=!0);t||(a().saver.userOrg.push(a().saver.userGroups[e].group.organization),"teacher"===a().saver.userGroups[e].role&&a().saver.userTeacherOrg.push(a().saver.userGroups[e].group.organization))}d("__________________ORG ="),d(a().saver.userOrg),d("__________________TEACHER ORG ="),d(a().saver.userTeacherOrg),d("__________________GROUP ="),d(a().saver.userGroups),d("__________________TEACHER GROUP ="),d(a().saver.userTeacherGroups)}(n.member_of_groups),e){case"/main":r.showOnlyOnePage("main-page");break;case"/office":p.whoami((e,t)=>e?(a().btn.loginBtn.click(),console.log("office error router")):(a().officePage.render(),r.showOnlyOnePage("office-page"),console.log("office norm router")));break;case"/info":r.showOnlyOnePage("info-page");break;case"/course":p.whoami((e,t)=>e?(a().btn.loginBtn.click(),console.log("office error router")):(r.showOnlyOnePage("course-page"),console.log("office norm router")));break;case"/group":r.showOnlyOnePage("group-page");break;case"/play":null===a().gameManager.game_id?(a().officePage.render(),a().btn.officeBtn.click(),d("NO GAME")):(r.showOnlyOnePage("play-page"),d("YES GAME"));break;case"/edit":r.showOnlyOnePage("edit-page");break;case"/teacher":null===a().gameManager.game_id?(a().officePage.render(),a().btn.officeBtn.click(),d("NO GAME")):(r.showOnlyOnePage("play-page-manage"),d("YES GAME"));break;default:r.showOnlyOnePage("office-page"),a().officePage.render(),r.showOnlyOnePage("office-page")}return console.log("NORM AUTH")}})}}window.addEventListener("load",function(){console.log("HELLO APP"),a().authWorker=new I,a().router=new U,a().router,document.querySelector(".main-box").hidden=!1})}]);