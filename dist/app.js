!function(e){var t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const s={};function o(){return s}class r{static hideAllPages(){let e=document.getElementsByClassName("page");for(let t=0;t<e.length;t++)e[t].hidden=!0}static showOnlyOnePage(e){r.hideAllPages(),document.querySelector("."+e).hidden=!1}}function a(...e){e.forEach(e=>{document.querySelector("#"+e.button).addEventListener("touchend",function(e){e.preventDefault(),e.target.click()},!1),document.querySelector("#"+e.button).addEventListener("click",()=>{r.showOnlyOnePage(e.nextPage),history.pushState({},"",e.pagePath)})})}class i{constructor(){i.pagePath(),i.pageBoxName(),this.addEventsOnButtons()}static pagePath(){}static pageBoxName(){}addEventsOnButtons(){}addRedirectOnButtons(...e){a(...e)}}const c={OK_MESSAGE:"ok",EMPTY_MESSAGE:"empty",INCORRECT_MESSAGE:"incorrect"};class l{static responseOk(){return c.OK_MESSAGE}static responseEmpty(){return c.EMPTY_MESSAGE}static responseIncorrect(){return c.INCORRECT_MESSAGE}static correctLogin(e){if(!e)return l.responseEmpty();return/^[\w\d]{3,10}$/.test(e)?l.responseOk():l.responseIncorrect()}static correctPassword(e){if(!e)return l.responseEmpty();return/\S{3,16}$/.test(e)?l.responseOk():l.responseIncorrect()}static correctQuiz(e){console.log(e);let t=[];return""===e.title&&t.push("title_empty"),""===e.description&&t.push("description_empty"),""===e.tags&&t.push("tags_empty"),e.questions.forEach((e,n)=>{""===e.question&&t.push(n+"_question_empty"),"NaN"===e.answer.toString()&&t.push(n+"_answer_empty"),"NaN"===e.points.toString&&t.push(n+"_points_empty"),e.variants.filter(e=>""!==e)<2&&t.push(n+"_variants_empty")}),t}}const d={HTTP_OK:2,XHR_READY:4},u=!0;class p{static baseUrl(){return"https://keklik-api.herokuapp.com/"}static requestToHost(e="GET",t,n=null,s){const r=new XMLHttpRequest;r.open(e,this.baseUrl()+t,!0),r.withCredentials=u;const a=JSON.stringify(n);r.setRequestHeader("Content-Type","application/json; charset=utf8"),r.setRequestHeader("Authorization",o().authWorker.getToken()),"GET"===e?r.send(null):r.send(a),r.onreadystatechange=function(){if(r.readyState!==d.XHR_READY)return;if(parseInt(+r.status/100)!==d.HTTP_OK)return s(r,null);const e=JSON.parse(r.responseText);s(null,e)}}static auth(e,t,n){const s={username:e,password:t};p.requestToHost("POST","api/session/",s,n)}static register(e,t,n){const s={username:e,password:t};p.requestToHost("POST","api/users/",s,n)}static whoami(e){p.requestToHost("GET","api/users/me/",null,e)}static quizEdit(e,t){p.requestToHost("POST","api/quizzes/",e,t)}}var g={clearFields(...e){e.forEach(e=>{const t="#"+e;let n=document.querySelector(t);"INPUT"===n.nodeName?n.value="":"DIV"===n.nodeName&&(n.innerHTML="")})}};const m={EMPTY_MESSAGE:"Заполнены не все поля",INCORRECT_MESSAGE:"Использованы недопустимые символы",RESPONSE_MESSAGE:"Некорректный ввод или логин уже существует",SUCCESS_SIGN_UP_MESSAGE:"Вы успешо зарегистрировались!"};class h extends l{constructor(){super(),Object.assign(h.prototype,g),this.loginValue="",this.passwordValue="",this.errorBox=null,this.addEventsToButtons(),console.log("reg FORM")}static msgEmptyField(){return m.EMPTY_MESSAGE}static msgIncorrectInput(){return m.INCORRECT_MESSAGE}static msgResponseFromHost(){return m.RESPONSE_MESSAGE}static msgSignUpSuccess(){return m.SUCCESS_SIGN_UP_MESSAGE}static validate(e,t,n){let s=l.correctLogin(e),o=l.correctPassword(t);return s===l.responseEmpty()||o===l.responseEmpty()?(n.innerHTML=h.msgEmptyField(),!1):s===l.responseIncorrect()||o===l.responseIncorrect()?(n.innerHTML=h.msgIncorrectInput(),!1):(n.innerHTML="",!0)}clearForm(){this.clearFields("regform-login","regform-password","regform-err")}sendRequest(){p.register(this.loginValue,this.passwordValue,(e,t)=>{if(e)return this.errorBox.innerHTML=h.msgResponseFromHost();o().authWorker.autharization(t),alert(h.msgSignUpSuccess()),this.clearForm(),o().officePage.render(),r.showOnlyOnePage("office-page")})}addEventsToButtons(){document.querySelector("#regformBtn").addEventListener("click",()=>{this.loginValue=document.querySelector("#regform-login").value,this.passwordValue=document.querySelector("#regform-password").value,this.errorBox=document.querySelector("#regform-err"),h.validate(this.loginValue,this.passwordValue,this.errorBox)&&this.sendRequest()})}}class v extends i{constructor(){super(),this.form=new h}static pagePath(){return"/register"}static pageBoxName(){return"register-page"}getForm(){return this.form}addEventsOnButtons(){}}const f={EMPTY_MESSAGE:"Заполнены не все поля",INCORRECT_MESSAGE:"Использованы недопустимые символы",RESPONSE_MESSAGE:"Некорректный ввод или логина не существует",SUCCESS_SIGN_IN_MESSAGE:"Вы вошли на сайт!"};class E extends l{constructor(){super(),Object.assign(E.prototype,g),this.loginValue="",this.passwordValue="",this.errorBox=null,this.addEventsToButtons(),console.log("log FORM")}static msgEmptyField(){return f.EMPTY_MESSAGE}static msgIncorrectInput(){return f.INCORRECT_MESSAGE}static msgResponseFromHost(){return f.RESPONSE_MESSAGE}static msgSignUpSuccess(){return f.SUCCESS_SIGN_IN_MESSAGE}static validate(e,t,n){let s=l.correctLogin(e),o=l.correctPassword(t);return s===l.responseEmpty()||o===l.responseEmpty()?(n.innerHTML=E.msgEmptyField(),!1):s===l.responseIncorrect()||o===l.responseIncorrect()?(n.innerHTML=E.msgIncorrectInput(),!1):(n.innerHTML="",!0)}clearForm(){this.clearFields("login-form-login","login-form-password","login-form-err")}sendRequest(){p.auth(this.loginValue,this.passwordValue,(e,t)=>{if(e)return this.errorBox.innerHTML=E.msgResponseFromHost();o().authWorker.autharization(t),alert(E.msgSignUpSuccess()),this.clearForm(),o().officePage.render(),r.showOnlyOnePage("office-page")})}addEventsToButtons(){document.querySelector("#login-form-btn").addEventListener("click",()=>{this.loginValue=document.querySelector("#login-form-login").value,this.passwordValue=document.querySelector("#login-form-password").value,this.errorBox=document.querySelector("#login-form-err"),console.log("log BTN"),E.validate(this.loginValue,this.passwordValue,this.errorBox)&&this.sendRequest()})}}class y extends i{constructor(){super(),this.form=new E}static pagePath(){return"/login"}static pageBoxName(){return"login-page"}getForm(){return this.form}addEventsOnButtons(){}}class b extends i{constructor(){super(),this.addRedirectOnButtons({button:"course-card-1",nextPage:"course-page",pagePath:"/course"}),this.addEventsOnButtons(),console.log("office"),o().user={}}static pagePath(){return"/office"}static pageBoxName(){return"office-page"}render(){return p.whoami((e,t)=>e?alert("office error"):(o().user=t,document.getElementById("office-header-username").innerHTML=o().user.username,console.log("office norm")))}addEventsOnButtons(){document.getElementById("to-courses-btn").onclick=(()=>{console.log("C1"),document.getElementById("courses-desk").hidden=!1,document.getElementById("to-quizes-btn").classList.remove("active"),document.getElementById("quizes-desk").hidden=!0,document.getElementById("to-courses-btn").classList.add("active"),document.getElementById("profile").hidden=!0,document.getElementById("to-profile-btn").classList.remove("active")}),document.getElementById("to-quizes-btn").onclick=(()=>{console.log("C2"),document.getElementById("courses-desk").hidden=!0,document.getElementById("to-quizes-btn").classList.add("active"),document.getElementById("quizes-desk").hidden=!1,document.getElementById("to-courses-btn").classList.remove("active"),document.getElementById("profile").hidden=!0,document.getElementById("to-profile-btn").classList.remove("active")}),document.getElementById("to-profile-btn").onclick=(()=>{console.log("C3"),document.getElementById("courses-desk").hidden=!0,document.getElementById("to-quizes-btn").classList.remove("active"),document.getElementById("quizes-desk").hidden=!0,document.getElementById("to-courses-btn").classList.remove("active"),document.getElementById("profile").hidden=!1,document.getElementById("to-profile-btn").classList.add("active")})}}class S extends i{constructor(){super(),this.addEventsOnButtons(),this.addRedirectOnButtons({button:"group-card-1",nextPage:"group-page",pagePath:"/group"}),console.log("course")}static pagePath(){return"/course"}static pageBoxName(){return"course-page"}addEventsOnButtons(){}}class O extends i{constructor(){super(),this.addEventsOnButtons(),this.addRedirectOnButtons({button:"to-play-btn-1",nextPage:"play-page",pagePath:"/play"}),console.log("group")}static pagePath(){return"/group"}static pageBoxName(){return"group-page"}addEventsOnButtons(){}}class q extends i{constructor(){super(),this.index=1,console.log("Quiz editor"),this.quiz={},this.resetQuiz()}resetQuiz(){this.quiz={title:"",description:"",tags:"",questions:[]}}addQuestion(){let e=document.createElement("div");e.innerHTML=function(e){return`<div class="edit-quiz-form__question-box" id="edit-quiz-form__question-box_${e}">\n            <div class="input-group mb-3">\n                <div class="input-group-prepend">\n                    <span class="input-group-text">Вопрос ${e+1} </span>\n                </div>\n                <textarea class="edit-question form-control" aria-label="Описание..."></textarea>\n            </div>\n\n            <div class="row edit-quiz-form-ans-row">\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-append">\n                            <span class="input-group-text">Вариант 1</span>\n                        </div>\n                        <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-append">\n                            <span class="input-group-text">Вариант 2</span>\n                        </div>\n                        <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n            </div>\n            <div class="row edit-quiz-form-ans-row">\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-append">\n                            <span class="input-group-text">Вариант 3</span>\n                        </div>\n                        <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-append">\n                            <span class="input-group-text">Вариант 4</span>\n                        </div>\n                        <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n            </div>\n            <div class="row edit-quiz-form-ans-row">\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-append">\n                            <span class="input-group-text">Вариант 5</span>\n                        </div>\n                        <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-append">\n                            <span class="input-group-text">Вариант 6</span>\n                        </div>\n                        <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n            </div>\n            <div class="row edit-quiz-form-ans-row">\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-append">\n                            <span class="input-group-text">Вариант 7</span>\n                        </div>\n                        <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-append">\n                            <span class="input-group-text">Вариант 8</span>\n                        </div>\n                        <input type="text" class="edit-variant form-control" placeholder="" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n            </div>\n            <div class="row edit-quiz-form-ans-row">\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-append">\n                            <span class="input-group-text bg-success text-white">Правильный варианта</span>\n                        </div>\n                        <input maxlength="1" type="text" class="edit-answer form-control" placeholder="1" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <div class="input-group-append">\n                            <span class="input-group-text bg-info text-white">Максимум очков за ответ</span>\n                        </div>\n                        <input maxlength="3" type="text" class="edit-points form-control" placeholder="5" aria-label="" aria-describedby="basic-addon2">\n                    </div>\n                </div>\n            </div>\n        </div><hr><br>`}(this.index),document.getElementById("edit-quiz-form__questions").appendChild(e),this.index++}pushToQuiz(){this.quiz.title=document.getElementById("edit-quiz-form").querySelector("#edit-quiz-form__title").value,this.quiz.description=document.getElementById("edit-quiz-form").querySelector("#edit-quiz-form__description").value,this.quiz.tags=document.getElementById("edit-quiz-form").querySelector("#edit-quiz-form__tags").value;let e=document.getElementsByClassName("edit-quiz-form__question-box");for(let t=0;t<e.length;t++){let n=[],s=e[t].getElementsByClassName("edit-variant"),o=s.length;for(let e=0;e<o;e++)n.push({variant:s[e].value.toString()});this.quiz.questions.push({number:t+1,type:"single",question:e[t].querySelector(".edit-question").value.toString(),variants:n,answer:parseInt(e[t].querySelector(".edit-answer").value),points:parseInt(e[t].querySelector(".edit-points").value)})}console.log(this.quiz)}validate(){let e=l.correctQuiz(this.quiz);return console.log("err = "+e),!0}sendRequest(){p.quizEdit(this.quiz,(e,t)=>e?console.log("err in quiz"):console.log("ok in quiz"+t))}addEventsOnButtons(){document.getElementById("edit-quiz-form__add-question-btn").onclick=(()=>{this.addQuestion()}),document.getElementById("edit-quiz-form__send-btn").onclick=(()=>{this.pushToQuiz(),this.validate()&&(this.sendRequest(),this.resetQuiz())})}}class P{constructor(){this.addRedirectOnNavBtn({button:"nav-main-btn",nextPage:"main-page",pagePath:"/main"},{button:"nav-login-btn",nextPage:"register-page",pagePath:"/register"},{button:"nav-info-btn",nextPage:"info-page",pagePath:"/info"},{button:"nav-office-btn",nextPage:"office-page",pagePath:"/office"}),o().registerPage=new v,o().loginPage=new y,o().officePage=new b,o().coursePage=new S,o().groupPage=new O,o().quizEditor=new q;v.pagePath();a({button:"regform-to-login-link",nextPage:"login-page",pagePath:"/login"},{button:"login-form-to-register-link",nextPage:"register-page",pagePath:"/register"}),P.redirect(),window.addEventListener("popstate",()=>{P.redirect()})}navigate(){}addRedirectOnNavBtn(...e){a(...e)}static redirect(){const e=window.location.pathname;switch(p.whoami(t=>{if(t){switch(document.getElementById("nav-signout-btn").hidden=!0,document.getElementById("nav-login-btn").hidden=!1,e){case"/main":r.showOnlyOnePage("main-page");break;case"/office":document.getElementById("nav-login-btn").click();break;case"/register":r.showOnlyOnePage("register-page");break;case"/login":r.showOnlyOnePage("login-page");break;case"/info":r.showOnlyOnePage("info-page");break;case"/teacher":r.showOnlyOnePage("play-page-manage");break;default:r.showOnlyOnePage("main-page")}return console.log("NOT AUTH")}return console.log("NORM AUTH")}),document.getElementById("nav-signout-btn").hidden=!1,document.getElementById("nav-login-btn").hidden=!0,e){case"/main":r.showOnlyOnePage("main-page");break;case"/office":p.whoami((e,t)=>e?(document.getElementById("nav-login-btn").click(),console.log("office error router")):(o().officePage.render(),r.showOnlyOnePage("office-page"),console.log("office norm router")));break;case"/info":r.showOnlyOnePage("info-page");break;case"/course":r.showOnlyOnePage("course-page");break;case"/group":r.showOnlyOnePage("group-page");break;case"/play":r.showOnlyOnePage("play-page");break;case"/edit":r.showOnlyOnePage("edit-page");break;case"/teacher":r.showOnlyOnePage("play-page-manage");break;default:r.showOnlyOnePage("office-page")}}}class w{getToken(){return null!==localStorage.getItem("token")?localStorage.getItem("token"):"no"}static setToken(e){let t="Token "+e.token.toString();localStorage.setItem("token",t),console.log("TOKEN = "+localStorage.getItem("token"))}static setUser(e){localStorage.setItem("user",JSON.stringify(e)),console.log("USER = "+localStorage.getItem("user"))}autharization(e){w.setToken(e),w.setUser(e)}}window.addEventListener("load",function(){console.log("HELLO APP"),o().authWorker=new w,o().router=new P,o().router,document.querySelector(".main-box").hidden=!1})}]);